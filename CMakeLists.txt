cmake_minimum_required(VERSION 3.10)
project(r3c LANGUAGES CXX)

# =====================================
# ğŸ”§ ê¸°ë³¸ ì„¤ì •
# =====================================
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# =====================================
# ğŸ” NASM í™•ì¸
# =====================================
find_program(NASM_EXECUTABLE nasm)
if (NASM_EXECUTABLE)
    message(STATUS "âœ… NASM found: ${NASM_EXECUTABLE}")
else()
    message(FATAL_ERROR "âŒ NASM not found. Please install NASM before building.")
endif()

# =====================================
# ğŸ“ ì†ŒìŠ¤ íŒŒì¼ ëª©ë¡
# =====================================
set(SRC_FILES
    src/main.cpp
    src/docgen.cpp
    src/formatter.cpp
    src/manifest.cpp
    src/pkgmgr.cpp
    src/r3c.cpp
    src/r3cpkg.cpp
)

# =====================================
# âš™ï¸ ì‹¤í–‰ íŒŒì¼ íƒ€ê¹ƒ
# =====================================
add_executable(r3c ${SRC_FILES})

# =====================================
# ğŸ’¾ ì¶œë ¥ ë””ë ‰í† ë¦¬ ì§€ì •
# =====================================
set_target_properties(r3c PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin"
)

# =====================================
# ğŸ§© ì¶”ê°€ include / ë§í¬ ì„¤ì • (í•„ìš”ì‹œ)
# =====================================
# target_include_directories(r3c PRIVATE include)
# target_link_libraries(r3c PRIVATE ...)

# =====================================
# ğŸ§ª ì¡°ê±´ë¶€ í…ŒìŠ¤íŠ¸ ì„¤ì •
# =====================================
if(EXISTS "${CMAKE_SOURCE_DIR}/tests/test_basic.cpp")
    message(STATUS "ğŸ§ª Test file found â†’ enabling test build...")
    enable_testing()
    add_executable(r3c_tests tests/test_basic.cpp)
    add_test(NAME r3c_tests COMMAND r3c_tests)
else()
    message(WARNING "âš ï¸ No tests found (tests/test_basic.cpp missing) â†’ skipping test target.")
endif()

# =====================================
# ğŸ§¾ ë¹Œë“œ ì •ë³´ ì¶œë ¥
# =====================================
message(STATUS "=====================================================")
message(STATUS "[r3c] Rust â†’ NASM â†’ Executable build pipeline enabled")
message(STATUS "C++ Compiler: ${CMAKE_CXX_COMPILER}")
message(STATUS "Build Type  : ${CMAKE_BUILD_TYPE}")
message(STATUS "=====================================================")
