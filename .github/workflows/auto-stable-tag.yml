name: üîñ Auto Stable Tag & Full Release (Immutable + PAT)

on:
  workflow_run:
    workflows: ["üß© R3C Cross-Platform Build (stable)"]
    types: [completed]

permissions:
  contents: read   # ‚úÖ PATÏù¥ ÎåÄÏã† write ÏàòÌñâ

env:
  GH_REPO: r3c-foundation/r3c
  GH_USER: r3c-bot
  GH_EMAIL: r3c-bot@users.noreply.github.com
  GH_TOKEN: ${{ secrets.GH_TOKEN }}   # ‚úÖ PATÏùÑ Ï†ÑÏó≠ ÌôòÍ≤Ω Î≥ÄÏàòÎ°ú Îì±Î°ù

jobs:
  release:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: üïí Generate immutable tag
        run: |
          TS=$(date -u +'%Y%m%d-%H%M%S')
          echo "TAG=auto-stable-${TS}" >> $GITHUB_ENV
          echo "‚úÖ Generated tag: auto-stable-${TS}"

      - name: ‚öôÔ∏è Configure Git with PAT
        run: |
          git config user.name "${GH_USER}"
          git config user.email "${GH_EMAIL}"
          git remote set-url origin https://x-access-token:${GH_TOKEN}@github.com/${GH_REPO}.git
          git fetch origin

      - name: üè∑Ô∏è Create and push tag (using PAT)
        run: |
          git tag "${TAG}"
          git push origin "${TAG}"
