name: 🌿 Auto Branch Creator

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: read

jobs:
  create-branch:
    # /branch 로 시작하는 댓글만 작동
    if: startsWith(github.event.comment.body, '/branch ')
    runs-on: ubuntu-latest

    steps:
      - name: 🧰 Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 🔍 Parse branch name
        id: parse
        run: |
          RAW="${{ github.event.comment.body }}"
          BRANCH=$(echo "$RAW" | sed 's/^\/branch[[:space:]]*//')
          echo "branch=$BRANCH" >> $GITHUB_ENV

      - name: 🌿 Create new branch
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git checkout -b "${{ env.branch }}"
          git push origin "${{ env.branch }}"

      - name: 💬 Notify success
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ✅ Branch **${{ env.branch }}** created successfully!  
            You can now push commits to `origin/${{ env.branch }}`.
